---
- name: Resilient Deployment Play
  hosts: "{{ group_names') | select('match', '^tag_Name_DevOpsEC2$') | list | default(['all']) }}"
  become: true
  gather_facts: true

  tasks:
    - name: Debug matched inventory hostnames
      debug:
        var: inventory_hostname

    - name: Install Docker & Docker Compose
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - docker.io
        - docker-compose

    - name: Copy Compose File
      copy:
        src: ../DOCKE/docker-compose.yml
        dest: /home/ubuntu/docker-compose.yml

    - name: Deploy Application
      command: docker-compose up -d
      args:
        chdir: /home/ubuntu
